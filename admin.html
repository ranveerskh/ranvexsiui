<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - RANVEXSI UI</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f9f9f9; }
    header { background: #4CAF50; color: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; }
    h1 { margin: 0; font-size: 1.4rem; }
    .container { padding: 20px; max-width: 1000px; margin: auto; }
    .section { background: white; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); padding: 20px; margin-bottom: 20px; }
    .section h2 { margin-top: 0; }
    .input-row { display: flex; gap: 10px; margin: 10px 0; }
    .input-row input { flex: 1; padding: 8px; }
    .list-item { margin: 5px 0; padding: 10px; border: 1px solid #ddd; border-radius: 6px; background: #f5f5f5; }
    button { padding: 8px 12px; margin-top: 10px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; }
    button.delete { background: red; }
    select, input[type=text] { padding: 8px; margin-top: 5px; }
  </style>
</head>
<body>
<header>
  <h1>Admin Panel - RANVEXSI UI</h1>
  <button onclick="saveToFirestore()">ðŸ’¾ Save Changes</button>
</header>
<div class="container">
  <div class="section">
    <h2>Departments</h2>
    <div class="input-row">
      <input id="newDept" placeholder="New Department Name">
      <button onclick="addDepartment()">+ Add Department</button>
    </div>
    <div id="departmentsList"></div>
  </div>
  <div class="section">
    <h2>Sub-Departments</h2>
    <select id="subDeptSelect"></select>
    <div class="input-row">
      <input id="newSubDept" placeholder="New Sub-Department Name">
      <button onclick="addSubDepartment()">+ Add Sub</button>
    </div>
    <div id="subDeptList"></div>
  </div>
  <div class="section">
    <h2>Links in Sub-Departments</h2>
    <select id="linkDeptSelect"></select>
    <select id="linkSubSelect"></select>
    <div class="input-row">
      <input id="linkName" placeholder="Link Name">
      <input id="linkUrl" placeholder="URL">
      <input id="linkImage" placeholder="Background Image URL">
      <button onclick="addLink()">+ Add Link</button>
    </div>
    <div id="linkList"></div>
  </div>
</div>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
  import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDoUb1kEA8bo0NaqSTDQSTtH4fWNdmJrAw",
    authDomain: "ranvexsi-ui.firebaseapp.com",
    projectId: "ranvexsi-ui",
    storageBucket: "ranvexsi-ui.firebasestorage.app",
    messagingSenderId: "639916549058",
    appId: "1:639916549058:web:2c14514e7d00aeaca52c5b"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  let structure = {};

  const deptList = document.getElementById("departmentsList");
  const subDeptList = document.getElementById("subDeptList");
  const linkList = document.getElementById("linkList");
  const subSelect = document.getElementById("subDeptSelect");
  const linkDeptSelect = document.getElementById("linkDeptSelect");
  const linkSubSelect = document.getElementById("linkSubSelect");

  async function loadStructure() {
    const snap = await getDoc(doc(db, "structure", "departments"));
    structure = snap.exists() ? snap.data() : {};
    renderAll();
  }

  function renderAll() {
    // Departments
    deptList.innerHTML = Object.keys(structure).map(dep => `
      <div class='list-item'>${dep}
        <button class='delete' onclick="deleteDepartment('${dep}')">ðŸ—‘</button>
      </div>
    `).join("");

    // Dropdowns
    subSelect.innerHTML = linkDeptSelect.innerHTML = Object.keys(structure).map(d => `<option>${d}</option>`).join("");
    updateSubSelect();
    renderSubDepartments();
    renderLinks();
  }

  function updateSubSelect() {
    const selectedDept = linkDeptSelect.value;
    const subs = structure[selectedDept]?.subs || {};
    linkSubSelect.innerHTML = subSelect.innerHTML = Object.keys(subs).map(s => `<option>${s}</option>`).join("");
  }

  function addDepartment() {
    const val = document.getElementById("newDept").value.trim();
    if (val && !structure[val]) {
      structure[val] = { image: "", subs: {} };
      renderAll();
    }
  }

  function deleteDepartment(dep) {
    delete structure[dep];
    renderAll();
  }

  function addSubDepartment() {
    const dept = subSelect.value;
    const sub = document.getElementById("newSubDept").value.trim();
    if (dept && sub) {
      structure[dept].subs[sub] = { links: [] };
      renderAll();
    }
  }

  function renderSubDepartments() {
    const dept = subSelect.value;
    const subs = structure[dept]?.subs || {};
    subDeptList.innerHTML = Object.keys(subs).map(s => `
      <div class='list-item'>${s} <button class='delete' onclick="deleteSubDepartment('${dept}','${s}')">ðŸ—‘</button></div>
    `).join("");
  }

  function deleteSubDepartment(dep, sub) {
    delete structure[dep].subs[sub];
    renderAll();
  }

  function addLink() {
    const d = linkDeptSelect.value;
    const s = linkSubSelect.value;
    const name = document.getElementById("linkName").value;
    const url = document.getElementById("linkUrl").value;
    const img = document.getElementById("linkImage").value;
    if (name && url) {
      structure[d].subs[s].links.push({ name, url, image: img });
      renderLinks();
    }
  }

  function renderLinks() {
    const d = linkDeptSelect.value;
    const s = linkSubSelect.value;
    const links = structure[d]?.subs[s]?.links || [];
    linkList.innerHTML = links.map((l, i) => `
      <div class='list-item'>${l.name} - <a href="${l.url}" target="_blank">${l.url}</a>
        <button class='delete' onclick="deleteLink('${d}','${s}',${i})">ðŸ—‘</button>
      </div>
    `).join("");
  }

  function deleteLink(dep, sub, idx) {
    structure[dep].subs[sub].links.splice(idx, 1);
    renderLinks();
  }

  window.saveToFirestore = async () => {
    await setDoc(doc(db, "structure", "departments"), structure);
    alert("Saved!");
  };

  loadStructure();
</script>
</body>
</html>
